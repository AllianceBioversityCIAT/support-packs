<div class="dmsp-home">
  <div class="firstColumn">
    <div class="filters">
      <div class="filters__item">
        <h2 class="filters__item--title">Who are you?</h2>

        <ng-container *ngIf="!selectedRole || !selectedWhat || !selectedWhen">
          <button
            *ngFor="let item of this.rolesData"
            class="filters__item--button"
            [ngClass]="{ selected: item?.selected }"
            (click)="selectedRole = item; filterInformation(); changesItemStatus(item, 'role')">
            <img [src]="item.img" [alt]="item.name" class="filters__item--button--image" />
            <p>{{ item.name }}</p>
          </button>
        </ng-container>

        <p-dropdown
          *ngIf="selectedRole && selectedWhat && selectedWhen"
          [options]="rolesData"
          [(ngModel)]="selectedRole"
          optionLabel="name"
          placeholder="Select a role"
          [style]="{ width: '100%', 'background-color': '#e3d34f', color: 'white' }"
          (ngModelChange)="filterInformation()">
          <ng-template pTemplate="selectedItem">
            <div class="filters__item--dropdown--content">
              <img [src]="selectedRole.img" [alt]="selectedRole.name" style="width: 15px" />
              <p>{{ selectedRole.name }}</p>
            </div>
          </ng-template>

          <ng-template let-roles pTemplate="item">
            <div class="filters__item--dropdown--content">
              <img [src]="roles.img" [alt]="roles.name" style="width: 50px" />
              <p>{{ roles.name }}</p>
            </div>
          </ng-template>
        </p-dropdown>
      </div>

      <div class="filters__item">
        <h2 class="filters__item--title">Where are you?</h2>

        <div
          class="filters__item--stageButtons"
          *ngIf="!selectedRole || !selectedWhat || !selectedWhen">
          <button
            *ngFor="let item of this.whenData; let i = index"
            class="filters__item--stageButtons--item"
            [ngClass]="{ selected: item?.selected }"
            (click)="selectedWhen = item; filterInformation(); changesItemStatus(item, 'when')">
            <div class="filters__item--stageButtons--item--button">
              <div class="filters__item--stageButtons--item--button--number">
                <p class="filters__item--stageButtons--item--button--number--text">
                  {{ i + 1 }}
                </p>
              </div>

              <div class="filters__item--stageButtons--item--button--content">
                <p class="filters__item--stageButtons--item--button--content--title">
                  {{ item.name }}
                </p>
                <p class="filters__item--stageButtons--item--button--content--desc">
                  {{ item.description }}
                </p>
              </div>
            </div>
          </button>
        </div>

        <div class="where-are" *ngIf="selectedRole && selectedWhat && selectedWhen">
          <p-dropdown
            [options]="whenData"
            [(ngModel)]="selectedWhen"
            optionLabel="name"
            placeholder="Select a where"
            [style]="{ width: '100%', 'background-color': '#1281aa' }"
            (ngModelChange)="filterInformation()"></p-dropdown>
        </div>
      </div>

      <div class="filters__item secondColumnWhat">
        <h2 class="filters__item--title">What</h2>

        <div class="secondColumn__buttons" *ngIf="!selectedRole || !selectedWhat || !selectedWhen">
          <button
            class="secondColumn__buttons--item"
            [ngClass]="{ selected: item?.selected }"
            (click)="selectedWhat = item; filterInformation(); changesItemStatus(item, 'what')"
            *ngFor="let item of this.whatData; let i = index">
            <p class="secondColumn__buttons--item--number">{{ i + 1 }}.</p>

            <p class="secondColumn__buttons--item--content">{{ item.name }}</p>
          </button>
        </div>

        <div class="what" *ngIf="selectedRole && selectedWhat && selectedWhen">
          <p-dropdown
            [options]="whatData"
            [(ngModel)]="selectedWhat"
            optionLabel="name"
            placeholder="Select a where"
            [style]="{ width: '100%', 'background-color': '#47939c' }"
            (ngModelChange)="filterInformation()"></p-dropdown>
        </div>
      </div>
    </div>

    <div class="results" *ngIf="selectedRole && selectedWhat && selectedWhen">
      <ng-container
        *ngIf="
          this.selectedRole &&
          this.selectedWhen &&
          this.selectedWhat &&
          !this._servicesVariables.termsConditions &&
          !this._servicesVariables.continue
        ">
        <div class="dmsp-home__header">
          <h2 class="dmsp-home__header--title">Guidelines Recommened</h2>

          <p class="dmsp-home__header--subtitle">
            Results:
            <span>Role</span> {{ selectedRole.name }}, <span>When</span>
            {{ selectedWhen.name }}
          </p>
        </div>

        <h2 class="dmsp-home__header--description">{{ selectedWhat.name }}</h2>

        <p-table
          [value]="productsData"
          [(selection)]="selectedProducts"
          dataKey="code"
          [tableStyle]="{ 'min-width': '50rem' }">
          <ng-template pTemplate="body" let-product>
            <tr>
              <td>
                <p-tableCheckbox [value]="product"></p-tableCheckbox>
              </td>

              <td>
                <i [class]="getIconByType(product.type)" style="margin-right: 5px"></i>
                {{ product.name }}
              </td>

              <td style="background-color: #f1f1f1">
                <div class="dmsp-home__table__info">
                  <div
                    class="dmsp-home__table__info--point numOne"
                    [ngStyle]="{
                      'background-color': getImportanceLevelColor(product.importance_level)
                    }"></div>

                  <div>{{ product.importance_level }}</div>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>

        <div class="dmsp-home__table__buttons">
          <button
            pButton
            label="New search"
            class="p-button-secondary"
            (click)="initNewSearch()"
            width="100%"></button>

          <button
            pButton
            *ngIf="selectedProducts?.length > 0"
            label="Download chosen documents"
            class="p-button-outlined"
            icon="pi pi-filter-pi-download"
            (click)="this._servicesVariables.termsAndConditions()"></button>
        </div>
      </ng-container>

      <app-terms-conditions
        *ngIf="this._servicesVariables.termsConditions"
        [app_id]="1"
        [tools]="selectedProducts"></app-terms-conditions>

      <ng-container
        *ngIf="
          this.selectedRole &&
          this.selectedWhen &&
          this.selectedWhat &&
          !this._servicesVariables.termsConditions &&
          this._servicesVariables.continue
        ">
        <div class="dmsp-home__header">
          <h2 class="dmsp-home__header--title">Guidelines Recommened</h2>

          <p class="dmsp-home__header--subtitle">
            Results:
            <span>Role</span> {{ selectedRole.name }}, <span>When</span>
            {{ selectedWhen.name }}
          </p>
        </div>

        <h2 class="dmsp-home__header--description">{{ selectedWhat.name }}</h2>

        <p-table [value]="selectedProducts" dataKey="code" [tableStyle]="{ 'min-width': '50rem' }">
          <ng-template pTemplate="body" let-product>
            <tr>
              <td>
                <a
                  [href]="product.source"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="dmsp-home__table--link">
                  <i [class]="getIconByType(product.type)" style="margin-right: 5px"></i>
                  {{ product.name }}
                </a>
              </td>

              <td style="background-color: #f1f1f1">
                <div class="dmsp-home__table__info">
                  <div
                    class="dmsp-home__table__info--point numOne"
                    [ngStyle]="{
                      'background-color': getImportanceLevelColor(product.importance_level)
                    }"></div>

                  <div>{{ product.importance_level }}</div>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>

        <div class="dmsp-home__table__buttons">
          <app-pdf-generate
            *ngIf="validateShowPdfButton().showPdfButton"
            [data]="validateShowPdfButton().ToolsType0"
            [app]="1"
            [buttonText]="validateShowPdfButton().buttonMessage"></app-pdf-generate>

          <button
            pButton
            label="New search"
            class="p-button-secondary"
            (click)="initNewSearch()"></button>
        </div>
      </ng-container>
    </div>
  </div>

  <div class="secondColumn">
    <h2 class="filters__item--title">What</h2>

    <div class="secondColumn__buttons">
      <button
        class="secondColumn__buttons--item"
        [ngClass]="{ selected: item?.selected }"
        (click)="selectedWhat = item; filterInformation(); changesItemStatus(item, 'what')"
        *ngFor="let item of this.whatData; let i = index">
        <p class="secondColumn__buttons--item--number">{{ i + 1 }}.</p>

        <p class="secondColumn__buttons--item--content">{{ item.name }}</p>
      </button>
    </div>
  </div>
</div>
