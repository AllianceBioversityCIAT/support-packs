<p-table
  [value]="tableData"
  [paginator]="true"
  [rows]="10"
  [showCurrentPageReport]="true"
  [tableStyle]="{ 'min-width': '40rem' }"
  [rowsPerPageOptions]="[10, 25, 50]"
  [loading]="tableDataLoading">
  <ng-template pTemplate="header">
    <tr>
      <th id="id">ID</th>
      <th id="name">Name</th>
      <th id="category">Category</th>
      <th id="actions">Actions</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-tool>
    <tr>
      <td>{{ tool.id }}</td>
      <td>{{ tool.name }}</td>
      <td>{{ tool.category_name }}</td>
      <td style="display: flex; flex-direction: row; align-items: center">
        <button
          pButton
          pRipple
          *ngIf="activeItem.id === 0 || activeItem.id === 2"
          type="button"
          icon="pi pi-pencil"
          class="p-button-rounded p-button-text"
          (click)="showEditDialog(tool)"></button>

        <button
          pButton
          pRipple
          *ngIf="activeItem.id === 1"
          type="button"
          icon="pi pi-check-circle"
          class="p-button-rounded p-button-text"
          (click)="showDialogDesactive(tool)"></button>

        <button
          pButton
          pRipple
          *ngIf="activeItem.id === 0"
          type="button"
          icon="pi pi-trash"
          class="p-button-rounded p-button-text"
          (click)="showDialogDesactive(tool)"></button>

        <button
          pButton
          pRipple
          *ngIf="activeItem.id === 2"
          type="button"
          icon="pi pi-check-square"
          class="p-button-rounded p-button-text"
          (click)="showDialogAccepted(tool)"></button>

        <button
          pButton
          pRipple
          *ngIf="activeItem.id === 2"
          type="button"
          icon="pi pi-times"
          class="p-button-rounded p-button-text"
          (click)="showDenyRequest(tool)"></button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="4">No tools found.</td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  header="Edit Tool"
  [(visible)]="EditModalOpen"
  [modal]="true"
  [draggable]="false"
  [breakpoints]="{ '1200px': '75vw', '575px': '90vw' }"
  [resizable]="false"
  (onHide)="onCloseEditModal()">
  <div class="formRequest__mainForm" *ngIf="step1 && EditModalOpen">
    <h3 class="formRequest__mainForm--title">Basic Information</h3>

    <div class="formRequest__mainForm__content" style="flex-direction: column">
      <div class="formRequest__mainForm__content--input">
        <b>Tool name</b>
        <input
          pInputText
          id="tool_name"
          aria-describedby="username-help"
          [(ngModel)]="informationEdit.name" />
      </div>

      <div class="formRequest__mainForm__content--input">
        <b>Description</b>
        <textarea
          style="resize: none"
          id="description"
          rows="5"
          pInputTextarea
          [(ngModel)]="informationEdit.description"></textarea>
      </div>

      <div class="formRequest__mainForm__content--twoColumns">
        <div class="formRequest__mainForm__content--input">
          <b>Link</b>
          <input
            pInputText
            id="link"
            aria-describedby="username-help"
            [(ngModel)]="informationEdit.source" />
        </div>

        <div class="formRequest__mainForm__content--input">
          <b>Estimated time to implement (excl. training)</b>
          <input
            pInputText
            id="eti"
            aria-describedby="username-help"
            [(ngModel)]="informationEdit.estimated_time" />
        </div>
      </div>

      <div class="formRequest__mainForm__content--twoColumns">
        <div class="formRequest__mainForm__content--input">
          <b>Does the tool integrate gender?</b>

          <div class="formRequest__mainForm__content--radioContainer">
            <div class="formRequest__mainForm__content--radio">
              <p-radioButton
                name="Yes"
                value="Yes"
                [(ngModel)]="informationEdit.integrates_gender"
                inputId="integratedGenderYes"></p-radioButton>
              <label for="integratedGenderYes">Yes</label>
            </div>

            <div class="formRequest__mainForm__content--radio">
              <p-radioButton
                name="No"
                value="No"
                [(ngModel)]="informationEdit.integrates_gender"
                inputId="integratedGenderNo"></p-radioButton>
              <label for="integratedGenderNo">No</label>
            </div>
          </div>
        </div>

        <div class="formRequest__mainForm__content--input">
          <b>Can this tool be tested online?</b>

          <div class="formRequest__mainForm__content--radioContainer">
            <div class="formRequest__mainForm__content--radio">
              <p-radioButton
                name="Yess"
                value="Yes"
                [(ngModel)]="informationEdit.is_tested_online"
                inputId="integratedTestedOnlineYes"></p-radioButton>
              <label for="integratedTestedOnlineYes">Yes</label>
            </div>

            <div class="formRequest__mainForm__content--radio">
              <p-radioButton
                name="Noo"
                value="No"
                [(ngModel)]="informationEdit.is_tested_online"
                inputId="integratedTestedOnlineNo"></p-radioButton>
              <label for="integratedTestedOnlineNo">No</label>
            </div>
          </div>
        </div>
      </div>

      <div class="formRequest__mainForm__content--twoColumns">
        <div class="formRequest__mainForm__content--input">
          <b>Target Scale</b>
          <textarea
            style="resize: none"
            id="target_scale"
            rows="5"
            pInputTextarea
            [(ngModel)]="informationEdit.target_scale"></textarea>
        </div>

        <div class="formRequest__mainForm__content--input">
          <b>Who participates?</b>
          <textarea
            style="resize: none"
            id="who_participates"
            rows="5"
            pInputTextarea
            [(ngModel)]="informationEdit.participants"></textarea>
        </div>
      </div>

      <div class="formRequest__mainForm__content--twoColumns">
        <div class="formRequest__mainForm__content--input">
          <b>Methods used</b>
          <textarea
            style="resize: none"
            id="methods"
            rows="5"
            pInputTextarea
            [(ngModel)]="informationEdit.methods"></textarea>
        </div>

        <div class="formRequest__mainForm__content--input">
          <b>Types of input data/information</b>
          <textarea
            style="resize: none"
            id="input_types"
            rows="5"
            pInputTextarea
            [(ngModel)]="informationEdit.input_types"></textarea>
        </div>
      </div>

      <div class="formRequest__mainForm__content--input">
        <b>Limitations</b>
        <textarea
          style="resize: none"
          id="limitations"
          rows="5"
          pInputTextarea
          [(ngModel)]="informationEdit.limitations"></textarea>
      </div>

      <div class="formRequest__mainForm__content--input">
        <b>Strengths</b>
        <textarea
          style="resize: none"
          id="strengths"
          rows="5"
          pInputTextarea
          [(ngModel)]="informationEdit.strengths"></textarea>
      </div>

      <div class="formRequest__mainForm__content--twoColumns">
        <div class="formRequest__mainForm__content--input">
          <b>Expected output(s)</b>
          <textarea
            style="resize: none"
            id="expected_outputs"
            rows="5"
            cols="30"
            pInputTextarea
            [(ngModel)]="informationEdit.expected_outputs"></textarea>
        </div>

        <div class="formRequest__mainForm__content--input">
          <b>Required human resources</b>
          <textarea
            id="required_human_resources"
            style="resize: none"
            rows="5"
            cols="30"
            pInputTextarea
            [(ngModel)]="informationEdit.human_resources"></textarea>
        </div>
      </div>

      <div class="formRequest__mainForm__content--twoColumns">
        <div class="formRequest__mainForm__content--input">
          <b>Key reference person(s)</b>
          <textarea
            id="key_references"
            style="resize: none"
            rows="5"
            cols="30"
            pInputTextarea
            [(ngModel)]="informationEdit.key_references"></textarea>
        </div>

        <div class="formRequest__mainForm__content--input">
          <b>Thematic area</b>
          <p-dropdown
            [options]="thematicAreas"
            [(ngModel)]="informationEdit.category_id"
            [style]="{ width: '100%' }"
            [virtualScroll]="true"
            [virtualScrollItemSize]="38"
            optionLabel="name"
            optionValue="id"
            placeholder="Select a Thematic area">
          </p-dropdown>
        </div>
      </div>
    </div>
  </div>

  <div class="formRequest__mainForm" *ngIf="step2 && EditModalOpen">
    <h3 class="formRequest__mainForm--title">User Profile and Project Phase relevance</h3>

    <div
      class="formRequest__mainForm__content"
      style="flex-direction: column; align-items: flex-start">
      <div class="title-user-con">
        <h4>Researcher</h4>
      </div>

      <div
        class="formRequest__mainForm__content--threeColumns"
        style="background-color: none; border: none; padding: 0; flex-wrap: wrap">
        <div class="formRequest__mainForm__content--input">
          <h4>Design</h4>

          <p-dropdown
            [options]="optionsImportance"
            [(ngModel)]="informationEdit.R.Design"
            optionLabel="name"
            [showClear]="true"
            [style]="{ width: '100%' }"
            placeholder="Select a Thematic area">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="informationEdit.R.Design">
                <div>{{ informationEdit.R.Design.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div class="formRequest__mainForm__content--input">
          <h4>Implementation</h4>
          <p-dropdown
            [options]="optionsImportance"
            [(ngModel)]="informationEdit.R.Implementation"
            optionLabel="name"
            [showClear]="true"
            [style]="{ width: '100%' }"
            placeholder="Select a Thematic area">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="informationEdit.R.Implementation">
                <div>{{ informationEdit.R.Implementation.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div class="formRequest__mainForm__content--input">
          <h4>Monitoring and evaluations</h4>
          <p-dropdown
            [options]="optionsImportance"
            [(ngModel)]="informationEdit.R.MonitoringandEvaluation"
            optionLabel="name"
            [showClear]="true"
            [style]="{ width: '100%' }"
            placeholder="Select a Thematic area">
            <ng-template pTemplate="selectedItem">
              <div
                class="flex align-items-center gap-2"
                *ngIf="informationEdit.R.MonitoringandEvaluation">
                <div>{{ informationEdit.R.MonitoringandEvaluation.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>
    </div>

    <div
      class="formRequest__mainForm__content"
      style="flex-direction: column; align-items: flex-start">
      <div class="title-user-con">
        <h4>Technical staff</h4>
      </div>

      <div
        class="formRequest__mainForm__content--threeColumns"
        style="background-color: none; border: none; padding: 0">
        <div class="formRequest__mainForm__content--input">
          <h4>Design</h4>
          <p-dropdown
            [options]="optionsImportance"
            [(ngModel)]="informationEdit.TS.Design"
            optionLabel="name"
            [showClear]="true"
            [style]="{ width: '100%' }"
            placeholder="Select a Thematic area">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="informationEdit.TS.Design">
                <div>{{ informationEdit.TS.Design.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div class="formRequest__mainForm__content--input">
          <h4>Implementation</h4>
          <p-dropdown
            [options]="optionsImportance"
            [(ngModel)]="informationEdit.TS.Implementation"
            optionLabel="name"
            [showClear]="true"
            [style]="{ width: '100%' }"
            placeholder="Select a Thematic area">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="informationEdit.TS.Implementation">
                <div>{{ informationEdit.TS.Implementation.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div class="formRequest__mainForm__content--input">
          <h4>Monitoring and evaluations</h4>
          <p-dropdown
            [options]="optionsImportance"
            [(ngModel)]="informationEdit.TS.MonitoringandEvaluation"
            optionLabel="name"
            [showClear]="true"
            [style]="{ width: '100%' }"
            placeholder="Select a Thematic area">
            <ng-template pTemplate="selectedItem">
              <div
                class="flex align-items-center gap-2"
                *ngIf="informationEdit.TS.MonitoringandEvaluation">
                <div>{{ informationEdit.TS.MonitoringandEvaluation.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>
    </div>

    <div
      class="formRequest__mainForm__content"
      style="flex-direction: column; align-items: flex-start">
      <div class="title-user-con">
        <h4>Academia</h4>
      </div>

      <div
        class="formRequest__mainForm__content--threeColumns"
        style="background-color: none; border: none; padding: 0">
        <div class="formRequest__mainForm__content--input">
          <h4>Design</h4>
          <p-dropdown
            [options]="optionsImportance"
            [(ngModel)]="informationEdit.A.Design"
            optionLabel="name"
            [showClear]="true"
            [style]="{ width: '100%' }"
            placeholder="Select a Thematic area">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="informationEdit.A.Design">
                <div>{{ informationEdit.A.Design.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div class="formRequest__mainForm__content--input">
          <h4>Implementation</h4>
          <p-dropdown
            [options]="optionsImportance"
            [(ngModel)]="informationEdit.A.Implementation"
            optionLabel="name"
            [showClear]="true"
            [style]="{ width: '100%' }"
            placeholder="Select a Thematic area">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="informationEdit.A.Implementation">
                <div>{{ informationEdit.A.Implementation.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div class="formRequest__mainForm__content--input">
          <h4>Monitoring and evaluations</h4>
          <p-dropdown
            [options]="optionsImportance"
            [(ngModel)]="informationEdit.A.MonitoringandEvaluation"
            optionLabel="name"
            [showClear]="true"
            [style]="{ width: '100%' }"
            placeholder="Select a Thematic area">
            <ng-template pTemplate="selectedItem">
              <div
                class="flex align-items-center gap-2"
                *ngIf="informationEdit.A.MonitoringandEvaluation">
                <div>{{ informationEdit.A.MonitoringandEvaluation.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>
    </div>

    <div
      *ngIf="informationEdit?.resources.length > 0"
      class="formRequest__mainForm__content"
      style="
        flex-direction: column;
        align-items: flex-start;
        background: none;
        border: none;
        padding: 0;
      ">
      <h3 class="formRequest__mainForm--title">Resources</h3>

      <div
        class="formRequest__mainForm__content"
        style="flex-direction: column; position: relative"
        *ngFor="let item of informationEdit.resources; let i = index">
        <div class="formRequest__mainForm__content--input">
          <b>Resource title</b>
          <input
            pInputText
            id="resource_title"
            autocomplete="off"
            aria-describedby="username-help"
            [(ngModel)]="item.name" />
        </div>

        <div class="formRequest__mainForm__content--twoColumns" style="margin-top: 1rem">
          <div class="formRequest__mainForm__content--input">
            <b>Link</b>
            <input
              pInputText
              id="link2"
              aria-describedby="username-help"
              [(ngModel)]="item.source" />
          </div>

          <div class="formRequest__mainForm__content--input">
            <h4>Category</h4>
            <p-dropdown
              [options]="categories"
              [(ngModel)]="item.type"
              [style]="{ width: '100%' }"
              [virtualScroll]="true"
              [virtualScrollItemSize]="38"
              optionValue="name"
              optionLabel="name"
              [filter]="true"
              filterBy="name"
              placeholder="Select a Thematic area">
            </p-dropdown>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="formRequest__mainForm__steps" *ngIf="EditModalOpen">
    <button
      pButton
      label="1"
      rounded="true"
      class="formRequest__mainForm__steps--button"
      [ngStyle]="{ 'background-color': step1 ? '#f2971f' : '#ffebd2' }"
      (click)="button1Validations()"></button>

    <button
      pButton
      label="2"
      rounded="true"
      class="formRequest__mainForm__steps--button"
      [ngStyle]="{ 'background-color': step2 ? '#f2971f' : '#ffebd2' }"
      (click)="button2Validations()"></button>

    <button
      pButton
      type="button"
      label="Edit tool"
      class="formRequest__mainForm__steps--button"
      style="background-color: #f2971f"
      (click)="editTool()"></button>
  </div>
</p-dialog>

<p-dialog
  [(visible)]="isSaving"
  [modal]="true"
  [style]="{ width: '10vw' }"
  [draggable]="false"
  [closable]="false"
  [resizable]="false">
  <div style="width: 100%; display: flex; align-items: center; justify-content: center">
    <img src="../../../../assets/loading.gif" alt="loading" style="width: 50px; height: 50px" />
  </div>
</p-dialog>

<p-dialog
  [(visible)]="desactiveModalOpen"
  [modal]="true"
  [style]="{ width: '40vw' }"
  [draggable]="false"
  [closable]="false"
  [resizable]="false">
  <div
    style="
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    ">
    <div>
      <p>
        Are you sure you want to {{ activeItem.id === 0 ? 'deactivate' : 'activate' }} this tool?
      </p>
    </div>
    <div style="margin-top: 20px">
      <button
        pButton
        label="Cancel"
        (click)="desactiveModalOpen = false"
        severity="danger"
        style="background-color: red"></button>
      <button
        pButton
        label="Accept"
        (click)="handleDesactive()"
        severity="success"
        style="background-color: rgb(0, 180, 120); margin-left: 10px"></button>
    </div>
  </div>
</p-dialog>

<p-dialog
  [(visible)]="acceptedModalOpen"
  [modal]="true"
  [style]="{ width: '40vw' }"
  [draggable]="false"
  [closable]="false"
  [resizable]="false">
  <div
    style="
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    ">
    <div>
      <p>Are you sure you want to accepted this tool?</p>
    </div>
    <div style="margin-top: 20px">
      <button
        pButton
        label="Cancel"
        (click)="acceptedModalOpen = false"
        severity="danger"
        style="background-color: red"></button>
      <button
        pButton
        label="Accept"
        (click)="acceptRequest()"
        severity="success"
        style="background-color: rgb(0, 180, 120); margin-left: 10px"></button>
    </div>
  </div>
</p-dialog>

<p-dialog
  [(visible)]="denyModalOpen"
  [modal]="true"
  [style]="{ width: '40vw' }"
  [draggable]="false"
  [closable]="false"
  [resizable]="false">
  <div
    style="
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    ">
    <div>
      <p>Are you sure you want to refuse this tool?</p>
    </div>
    <div style="margin-top: 20px">
      <button
        pButton
        label="Cancel"
        (click)="denyModalOpen = false"
        severity="danger"
        style="background-color: red"></button>
      <button
        pButton
        label="Accept"
        (click)="denyRequest()"
        severity="success"
        style="background-color: rgb(0, 180, 120); margin-left: 10px"></button>
    </div>
  </div>
</p-dialog>
