<div class="home__description">
  <p>
    The CGIAR Monitoring, Evaluation and Learning Support Pack is a guide and compilation of
    documents, templates, examples and experience sharing. It can be searched by user groups
    (program manager, project manager, Monitoring and Evaluation expert), stages along the research
    for development lifecycle (design, implementation, closure) or by thematic areas. The resource
    materials or links to useful external sources are graded for each group and stage as very
    important, useful, optional.
  </p>
  <p>
    The toolkit has (see at the bottom) a download functionality to access the templates and
    examples and an upload functionality by which we invite colleagues and partners to add any
    useful resource to the toolkit. The upload button triggers a brief checking process to ensure
    the proposed materials are relevant and of the desired quality (including given credits and
    taking care of branding).
  </p>
  <p>
    Please share any feedback and improvement suggestions with us, we will try and address these as
    much as possible.
  </p>
</div>

<div class="home__filters" *ngIf="!this._servicesVariables.termsConditions">
  <p-dropdown
    [options]="rolesData"
    [(ngModel)]="selectedRole"
    (ngModelChange)="filterInformation()"
    optionLabel="name"
    placeholder="Choose a role"
    [style]="{ width: '100%', 'background-color': '#d47979', color: 'white' }"
    [disabled]="this._servicesVariables.continue">
    <ng-template pTemplate="selectedItem">
      <div
        style="display: flex; align-items: center; justify-content: flex-start; gap: 0.5rem"
        *ngIf="selectedRole">
        <img
          src="../../../../assets/icon-1.png"
          alt="Person icon"
          style="width: 20px; height: 20px" />
        <div style="color: white">{{ selectedRole.name }}</div>
      </div>
    </ng-template>
  </p-dropdown>

  <p-dropdown
    [options]="whenData"
    [(ngModel)]="selectedWhen"
    (ngModelChange)="filterInformation()"
    optionLabel="name"
    placeholder="Choose a when"
    [style]="{ width: '100%', 'background-color': '#d47979', color: 'white' }"
    [disabled]="this._servicesVariables.continue">
    <ng-template pTemplate="selectedItem">
      <div
        style="display: flex; align-items: center; justify-content: flex-start; gap: 0.5rem"
        *ngIf="selectedWhen">
        <img
          src="../../../../assets/icon-2.png"
          alt="Clock icon"
          style="width: 20px; height: 20px" />
        <div style="color: white">{{ selectedWhen.name }}</div>
      </div>
    </ng-template>
  </p-dropdown>

  <p-dropdown
    [options]="whatData"
    [(ngModel)]="selectedWhat"
    (ngModelChange)="filterInformation()"
    optionLabel="name"
    placeholder="Choose a what"
    autoWidth="false"
    [style]="{ width: '100%', 'background-color': '#d47979', color: 'white' }"
    appendTo="body"
    [disabled]="this._servicesVariables.continue">
    <ng-template pTemplate="selectedItem">
      <div
        style="display: flex; align-items: center; justify-content: flex-start; gap: 0.5rem"
        *ngIf="selectedWhat">
        <img
          src="../../../../assets/icon-3.png"
          alt="Interrogation symbol icon"
          style="width: 20px; height: 20px" />
        <div style="color: white">{{ selectedWhat.name }}</div>
      </div>
    </ng-template>
  </p-dropdown>
</div>

<div class="home__notFilter" *ngIf="!selectedRole || !selectedWhat || !selectedWhen">
  <h3>Please select the 3 option(s) above</h3>
  <div class="home__notFilter--images">
    <img
      src="../../../../assets/icon-1.png"
      alt="Person icon"
      [ngStyle]="{ opacity: selectedRole ? '1' : '0.5' }" />
    <img
      src="../../../../assets/icon-2.png"
      alt="Clock icon"
      class="checkIcon"
      [ngStyle]="{ opacity: selectedWhen ? '1' : '0.5' }" />
    <img
      src="../../../../assets/icon-3.png"
      alt="Interrogation symbol icon"
      class="checkIcon"
      [ngStyle]="{ opacity: selectedWhat ? '1' : '0.5' }" />
  </div>
</div>

<ng-container
  *ngIf="
    this.selectedRole &&
    this.selectedWhen &&
    this.selectedWhat &&
    !this._servicesVariables.termsConditions &&
    !this._servicesVariables.continue
  ">
  <div class="home__header">
    <h2 class="home__header--title">Documents recomended</h2>

    <p class="home__header--subtitle">
      <span>{{ productsData?.length }}</span> Documents found for a
      <span>{{ selectedRole.name }}</span> at <span>{{ selectedWhen.name }}</span> stage
    </p>
  </div>

  <h2 class="home__header--description">{{ selectedWhat.name }}</h2>

  <p-table
    [value]="productsData"
    [(selection)]="selectedProducts"
    dataKey="code"
    [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template pTemplate="body" let-product>
      <tr>
        <td>
          <p-tableCheckbox [value]="product"></p-tableCheckbox>
        </td>

        <td>{{ product.name }}</td>

        <td style="background-color: #f1f1f1">
          <div class="home__table__info">
            <div
              class="home__table__info--point numOne"
              [ngStyle]="{
                'background-color': getImportanceLevelColor(product.importance_level)
              }"></div>

            <div>{{ product.importance_level }}</div>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="home__table__buttons">
    <button
      pButton
      label="New search"
      class="p-button-secondary"
      (click)="initNewSearch()"
      width="100%"></button>

    <button
      pButton
      *ngIf="selectedProducts?.length > 0"
      label="Download chosen documents"
      class="p-button-outlined"
      icon="pi pi-filter-pi-download"
      (click)="this._servicesVariables.termsAndConditions()"></button>
  </div>
</ng-container>

<div *ngIf="this._servicesVariables.termsConditions">
  <app-terms-conditions [app_id]="2" [tools]="selectedProducts"></app-terms-conditions>
</div>

<ng-container
  *ngIf="
    this.selectedRole &&
    this.selectedWhen &&
    this.selectedWhat &&
    !this._servicesVariables.termsConditions &&
    this._servicesVariables.continue
  ">
  <div class="home__header">
    <h2 class="home__header--title">Documents recomended</h2>

    <p class="home__header--subtitle">
      <span>{{ selectedProducts?.length }}</span> Documents found for a
      <span>{{ selectedRole.name }}</span> at <span>{{ selectedWhen.name }}</span> stage
    </p>
  </div>

  <h2 class="home__header--description">{{ selectedWhat.name }}</h2>

  <p-table [value]="selectedProducts" dataKey="code" [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template pTemplate="body" let-product>
      <tr>
        <td>
          <a [href]="product.source" target="_blank" rel="noopener noreferrer">
            {{ product.name }}
          </a>
        </td>

        <td style="background-color: #f1f1f1">
          <div class="home__table__info">
            <div
              class="home__table__info--point numOne"
              [ngStyle]="{
                'background-color': getImportanceLevelColor(product.importance_level)
              }"></div>

            <div>{{ product.importance_level }}</div>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="home__table__buttons">
    <app-pdf-generate [data]="selectedProducts" [app]="1"></app-pdf-generate>

    <button
      pButton
      label="New search"
      class="p-button-secondary"
      (click)="initNewSearch()"></button>
  </div>
</ng-container>
